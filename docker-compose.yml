services:
  # 1. Your Existing Django App
  web:
    build: .
    container_name: xstake_web
    restart: always
    ports:
      - "8000:8000"
    volumes:
      - ./bookmaker/db.sqlite3:/app/bookmaker/db.sqlite3
      - ./bookmaker/media:/app/bookmaker/media
    env_file:
      - ./bookmaker/.env
    environment:
      - DEBUG=False
      - ALLOWED_HOSTS=*
    depends_on:
      - redis  # Wait for Redis to start before starting Django

  # 2. The Redis Message Broker
  redis:
    image: redis:alpine
    container_name: xstake_redis
    restart: always
    ports:
      - "6379:6379"

  # 3. The Celery Worker
  celery:
    build: .
    container_name: xstake_celery
    restart: always
    # NOTE: Change 'your_project_name' to the folder name where your celery.py lives!
    command: celery -A your_project_name worker -l info
    volumes:
      - ./bookmaker/db.sqlite3:/app/bookmaker/db.sqlite3
      - ./bookmaker/media:/app/bookmaker/media
    env_file:
      - ./bookmaker/.env
    depends_on:
      - redis
      - web